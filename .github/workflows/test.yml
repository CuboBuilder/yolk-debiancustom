name: Test Yolk Integrity

on:
  workflow_dispatch:

jobs:
  test-yolk:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build Local Image
        run: docker build -t local-test-yolk .

      - name: System Identity & Permission Test
        run: |
          echo "--- Testing Identity ---"
          docker run --rm local-test-yolk whoami
          docker run --rm local-test-yolk id
          
      - name: Version Check - Node, Python, FFmpeg
        run: |
          echo "--- Testing Runtimes ---"
          docker run --rm local-test-yolk node -v
          docker run --rm local-test-yolk npm -v
          docker run --rm local-test-yolk python3 --version
          docker run --rm local-test-yolk pip3 --version
          docker run --rm local-test-yolk ffmpeg -version | head -n 1

      - name: Sudo & Dynamic Install Test
        run: |
          echo "--- Testing Sudo & Neofetch ---"
          docker run --rm local-test-yolk /bin/bash -c "sudo apt update && sudo apt install -y neofetch && neofetch --off"

      - name: Pterodactyl Variable Simulation
        run: |
          echo "--- Testing Entrypoint Logic ---"
          # This ensures your sed logic actually executes the STARTUP variable
          docker run --rm -e STARTUP="echo 'Hello from Pterodactyl!'" local-test-yolk
